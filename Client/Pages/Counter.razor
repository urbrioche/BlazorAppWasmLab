@page "/counter"

<PageTitle>Counter</PageTitle>

<h1>Hello, StateHasChanged!</h1>

<div>
    <button class="btn btn-primary" @onclick="PeriodicUpdate">定時更新</button>
</div>
<h3 class="text-danger">@message</h3>
<br />
@code{
    string message = "";
    int counter = 0;
    void PeriodicUpdate()
    {
        message = "啟動定時更新訊息";
        var task = Task.Run(async () =>
        {
            // 這邊會有射後不理的問題
            // 當網頁切到別頁，這個回圈仍會持續進行，可以設中斷點或觀察console寫出來的時間
            while (true)
            {
                await Task.Delay(2000);
                message = $"計數器數值 : {++counter}";
                Console.WriteLine(DateTime.Now);
                await InvokeAsync(() =>
                {
                    StateHasChanged();
                });
            }
        });
    }
}
